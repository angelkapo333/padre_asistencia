<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PRESENTEC ‚Äî Asistencia con verificaci√≥n por correo</title>
<style>
  :root{--color:#0b5ed7;--bg:#f4f7fb}
  body{font-family:Arial,Helvetica,sans-serif;margin:0;background:var(--bg);padding:24px;color:#222}
  .container{max-width:650px;margin:0 auto;background:#fff;padding:24px;border-radius:12px;box-shadow:0 5px 20px rgba(0,0,0,0.08)}
  h1{color:var(--color)}
  label{display:block;margin-top:10px;font-weight:bold}
  input,button{width:100%;padding:10px;margin-top:5px;border-radius:8px;border:1px solid #ccc;font-size:15px}
  button{background:var(--color);color:#fff;border:none;cursor:pointer;margin-top:12px}
  button:hover{background:#0846a3}
  .small{font-size:13px;color:#555}
  .ok{color:green;font-weight:bold}
  .err{color:#c00;font-weight:bold}
  table{width:100%;border-collapse:collapse;margin-top:20px}
  th,td{border-bottom:1px solid #ddd;padding:8px;text-align:left}
  #verifStep{display:none;margin-top:20px}
  .log{background:#0b1220;color:#aee;border-radius:8px;padding:8px;margin-top:20px;height:150px;overflow:auto;font-family:monospace;font-size:13px}
</style>
</head>
<body>
<div class="container">
  <h1>PRESENTEC ‚Äî Asistencia con verificaci√≥n por correo</h1>
  <p class="small">Este ejemplo implementa <b>verificaci√≥n de dos pasos (2FA)</b> simulada. Cuando el alumno inicia sesi√≥n, el sistema genera un c√≥digo y lo ‚Äúenv√≠a‚Äù a su correo institucional (aqu√≠ se muestra en pantalla para pruebas).</p>

  <h3>1Ô∏è‚É£ Iniciar sesi√≥n</h3>
  <form id="loginForm">
    <label>Correo institucional:</label>
    <input type="email" id="email" placeholder="ej: alumno@instituto.edu.ar" required>
    <label>Contrase√±a:</label>
    <input type="password" id="password" placeholder="contrase√±a (demo: 1234)" required>
    <button type="submit">Solicitar c√≥digo de verificaci√≥n</button>
  </form>

  <div id="verifStep">
    <h3>2Ô∏è‚É£ Verificaci√≥n</h3>
    <label>Ingres√° el c√≥digo recibido por mail:</label>
    <input type="text" id="codeInput" placeholder="6 d√≠gitos" maxlength="6">
    <button id="verifyBtn">Verificar y registrar asistencia</button>
  </div>

  <p id="msg" style="margin-top:12px"></p>

  <h3>üìã Asistencias registradas</h3>
  <table id="tablaAsis">
    <thead><tr><th>Email</th><th>Fecha</th><th>Hora</th><th>Estado</th></tr></thead>
    <tbody></tbody>
  </table>

  <h3>üßæ Log de eventos (trazabilidad)</h3>
  <div id="log" class="log"></div>
</div>

<script>
// ====== Datos simulados ======
const users = [
  {email:'sofia.martinez@instituto.edu', password:'1234', activo:true},
  {email:'juan.perez@instituto.edu', password:'1234', activo:true},
  {email:'camila.gomez@instituto.edu', password:'1234', activo:false}
];

const asistencias = [];
const logs = [];
const nowDate = ()=> new Date().toISOString().split('T')[0];
const nowTime = ()=> new Date().toTimeString().split(' ')[0];
const addLog = (msg)=>{ logs.unshift(`[${new Date().toLocaleTimeString()}] ${msg}`); renderLog(); };

let currentUser=null;
let codigoActual=null;

// ====== Render de tablas ======
function renderAsis(){
  const tbody=document.querySelector("#tablaAsis tbody");
  tbody.innerHTML="";
  asistencias.forEach(a=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${a.email}</td><td>${a.fecha}</td><td>${a.hora}</td><td>${a.estado}</td>`;
    tbody.appendChild(tr);
  });
}
function renderLog(){
  document.getElementById("log").innerText=logs.join("\n");
}

// ====== Paso 1: Solicitar c√≥digo ======
document.getElementById("loginForm").addEventListener("submit",ev=>{
  ev.preventDefault();
  const email=document.getElementById("email").value.trim().toLowerCase();
  const pass=document.getElementById("password").value.trim();
  const user=users.find(u=>u.email===email);
  const msg=document.getElementById("msg");

  if(!user){ msg.innerHTML="<span class='err'>‚ùå Usuario no encontrado</span>"; addLog(`Intento fallido: ${email} (usuario no existe)`); return; }
  if(user.password!==pass){ msg.innerHTML="<span class='err'>‚ùå Contrase√±a incorrecta</span>"; addLog(`Intento fallido: ${email} (contrase√±a incorrecta)`); return; }
  if(!user.activo){ msg.innerHTML="<span class='err'>üö´ Cuenta inactiva</span>"; addLog(`Intento fallido: ${email} (cuenta inactiva)`); return; }

  currentUser=user;
  codigoActual=Math.floor(100000+Math.random()*900000).toString();
  msg.innerHTML=`üìß Se envi√≥ un c√≥digo al correo <b>${email}</b><br><span class='small'>(Simulaci√≥n: tu c√≥digo es <b>${codigoActual}</b>)</span>`;
  document.getElementById("verifStep").style.display="block";
  addLog(`C√≥digo generado para ${email}: ${codigoActual}`);
});

// ====== Paso 2: Verificar y registrar ======
document.getElementById("verifyBtn").addEventListener("click",()=>{
  const code=document.getElementById("codeInput").value.trim();
  const msg=document.getElementById("msg");

  if(!codigoActual){ msg.innerHTML="<span class='err'>Primero solicita un c√≥digo.</span>"; return; }
  if(code!==codigoActual){ msg.innerHTML="<span class='err'>‚ùå C√≥digo incorrecto.</span>"; addLog(`C√≥digo incorrecto ingresado por ${currentUser.email}`); return; }

  asistencias.unshift({
    email:currentUser.email,
    fecha:nowDate(),
    hora:nowTime(),
    estado:"Presente"
  });
  msg.innerHTML="<span class='ok'>‚úÖ C√≥digo verificado. Asistencia registrada correctamente.</span>";
  addLog(`Asistencia registrada: ${currentUser.email}`);
  renderAsis();
  document.getElementById("verifStep").style.display="none";
  codigoActual=null;
});
</script>
</body>
</html>
